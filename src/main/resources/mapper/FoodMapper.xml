<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MeowMeowPunch.pickeat.domain.diet.repository.FoodMapper">
    <select id="findFoodSummariesForCursor"
            resultType="MeowMeowPunch.pickeat.global.common.dto.response.diet.FoodSummary">
        SELECT
        id,
        name,
        base_amount AS baseAmount,
        base_unit AS baseUnit,
        kcal AS kcal,
        carbs AS carbs,
        protein AS protein,
        fat AS fat,
        thumbnail_url AS thumbnailUrl
        FROM foods
        WHERE 1 = 1
        <if test="categoryPatterns != null and categoryPatterns.size() &gt; 0">
            AND (
            <foreach collection="categoryPatterns" item="pat" separator=" OR ">
                category ILIKE #{pat}
            </foreach>
            )
        </if>
        <if test="cursorId != null">
            AND id &gt; #{cursorId}
        </if>
        ORDER BY id ASC
        LIMIT #{limit}
    </select>

    <select id="findFoodSummariesByKeyword"
            resultType="MeowMeowPunch.pickeat.global.common.dto.response.diet.FoodSummary">
        SELECT
        id,
        name,
        base_amount AS baseAmount,
        base_unit AS baseUnit,
        kcal AS kcal,
        carbs AS carbs,
        protein AS protein,
        fat AS fat,
        thumbnail_url AS thumbnailUrl
        FROM foods
        WHERE name ILIKE CONCAT('%', #{keyword}, '%')
        <if test="categoryPatterns != null and categoryPatterns.size() &gt; 0">
            AND (
            <foreach collection="categoryPatterns" item="pat" separator=" OR ">
                category ILIKE #{pat}
            </foreach>
            )
        </if>
        <if test="cursorId != null">
            AND id &gt; #{cursorId}
        </if>
        ORDER BY id ASC
        LIMIT #{limit}
    </select>

    <select id="findFoodsByKeywordCount" resultType="int">
        SELECT COUNT(*)
        FROM foods
        WHERE name ILIKE CONCAT('%', #{keyword}, '%')
        <if test="categoryPatterns != null and categoryPatterns.size() &gt; 0">
            AND (
            <foreach collection="categoryPatterns" item="pat" separator=" OR ">
                category ILIKE #{pat}
            </foreach>
            )
        </if>
    </select>
</mapper>
